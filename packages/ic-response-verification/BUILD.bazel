load("@rules_rust//rust:defs.bzl", "rust_shared_library")
load("@crate_index//:defs.bzl", "aliases", "all_crate_deps")

filegroup(
    name = "srcs",
    srcs = glob(["src/**/*.rs"]),
)

rust_shared_library(
    name = "lib",
    srcs = [":srcs"],
    aliases = aliases(),
    proc_macro_deps = all_crate_deps(proc_macro = True),
    rustc_flags = [
        "-C",
        "opt-level=z",
        "-C",
        "codegen-units=1",
        "-C",
        "lto",
    ],
    visibility = ["//packages/ic-response-verification-wasm:__pkg__"],
    deps = all_crate_deps(normal = True),
)

rust_shared_library(
    name = "lib_debug",
    srcs = [":srcs"],
    crate_features = ["debug"],
    aliases = aliases(),
    proc_macro_deps = all_crate_deps(proc_macro = True),
    visibility = ["//packages/ic-response-verification-wasm:__pkg__"],
    deps = all_crate_deps(normal = True),
)
